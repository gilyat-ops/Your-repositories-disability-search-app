<script>
const disabilityData = [
  {"disease":"Autism Spectrum Disorder","subtitle":"קל, תפקוד עצמאי","percent":0.3},
  {"disease":"Autism Spectrum Disorder","subtitle":"קל, קושי חברתי","percent":0.5},
  {"disease":"Autism Spectrum Disorder","subtitle":"קל, קושי ראייתי","percent":0.7}
];

function toPercentNumber(v) {
  const n = Number(v);
  if (!Number.isFinite(n)) return 0;
  if (n > 0 && n < 1) return n * 100;
  return n;
}

function calcCombined(percentList) {
  if (!percentList.length) return 0;
  let combined = percentList[0];
  for (let i = 1; i < percentList.length; i++) {
    combined = combined + (100 - combined) * (percentList[i] / 100);
  }
  return combined;
}

document.getElementById("searchBtn").onclick = () => {
  const term = document.getElementById("searchInput").value.toLowerCase().trim();
  const results = disabilityData.filter(x => 
    x.disease.toLowerCase().includes(term) || 
    x.subtitle.toLowerCase().includes(term)
  );

  const container = document.getElementById("results");
  container.innerHTML = "";

  if (!results.length) {
    container.innerHTML = "<p>אין תוצאות</p>";
    return;
  }

  results.forEach(x => {
    const p = Math.round(toPercentNumber(x.percent));
    container.innerHTML += `
      <div class="card">
        <h3>${x.disease}</h3>
        <p>${x.subtitle}</p>
        <strong>${p}% נכות</strong>
      </div>`;
  });
};

document.getElementById("calcBtn").onclick = () => {
  const input = document.getElementById("calcInput").value;
  const nums = input.split(/[, ]+/).map(v => {
    const p = toPercentNumber(v);
    return p > 100 ? 100 : p;
  }).filter(x => x >= 0);

  nums.sort((a, b) => b - a);
  const total = calcCombined(nums);
  const combinedTotal = Math.min(total, 100);

  document.getElementById("totalBox").textContent = combinedTotal.toFixed(1) + "%";
};
</script>
