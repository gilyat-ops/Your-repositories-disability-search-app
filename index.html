<script>
  // טוען נתונים באמת
  fetch('./disability_table.json', { cache: "no-store" })
    .then(r => r.json())
    .then(d => {
      DATA = d;
      statusEl.textContent = "נטענו " + DATA.length + " רשומות";
      render();
    });

  // חיפוש הכי פשוט בעולם
  function render(){
    const q = document.getElementById('search').value.trim().toLowerCase();
    const list = DATA.filter(x => {
      const text = (x.disease + " " + x.sub_disease + " " + x.system).toLowerCase();
      return text.includes(q);
    });

    document.getElementById('results').innerHTML = list.map(x => {
      const pct = toPercentNumber(x.percent);
      return `
      <div class="result">
        <div class="title">${x.disease}</div>
        <div class="subtitle">${x.sub_disease}</div>
        <div class="meta">מערכת: ${x.system}</div>
        <div class="pct">${Math.round(pct)}%</div>
      </div>`;
    }).join("");
  }

  // המרה בטוחה של שבר לאחוז
  function toPercentNumber(v){
    const n = Number(v);
    if(!Number.isFinite(n)) return null;
    if(n > 0 && n < 1) return n * 100;
    return n;
  }

  // מאפשר גם מחשבון בסיסי
  function calcCombined(ps){
    let t = 0;
    for(const p of ps) t = t + p*(100-t)/100;
    return t;
  }

  document.getElementById('clearBtn').onclick = () => {
    document.getElementById('search').value = "";
    render();
  };
</script>
